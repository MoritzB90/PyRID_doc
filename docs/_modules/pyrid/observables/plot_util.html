<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pyrid.observables.plot_util &mdash; PyRID 15.06.2022 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/my_theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/design-tabs.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> PyRID
            <img src="../../../_static/PyRID_Logo_Render2_cropped.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Users</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Users/Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Users/User_Guide/Contents.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Users/Examples/Contents.html">Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Developers/Overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Developers/Developer%20API/Contents.html">Developer API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Developers/Theory/Contents.html">Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Developers/Validation/Contents.html">Validation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../References.html">References</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/MoritzB90/PyRID">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/">PyPI</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.youtube.com/channel/UC4o41QLwsfeh0g981MZPl7w">Youtube</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">license</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">PyRID</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>pyrid.observables.plot_util</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pyrid.observables.plot_util</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">@author: Moritz F P Becker</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d.art3d</span> <span class="kn">import</span> <span class="n">Poly3DCollection</span><span class="p">,</span> <span class="n">Line3DCollection</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span><span class="p">,</span> <span class="n">combinations</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">col</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;colorblind&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">matplotlib.font_manager</span> <span class="kn">import</span> <span class="n">FontProperties</span>
<span class="n">fontLgd</span> <span class="o">=</span> <span class="n">FontProperties</span><span class="p">()</span>
<span class="n">fontLgd</span><span class="o">.</span><span class="n">set_size</span><span class="p">(</span><span class="s1">&#39;x-small&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">plotly.io</span> <span class="k">as</span> <span class="nn">pio</span>
<span class="c1">#pio.renderers.default = &#39;svg&#39;</span>
<span class="n">pio</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="s1">&#39;browser&#39;</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;ticks&#39;</span><span class="p">)</span>

<span class="c1">#%%</span>

<span class="n">core_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.12156863</span><span class="p">,</span> <span class="mf">0.46666667</span><span class="p">,</span> <span class="mf">0.70588235</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">1.</span>        <span class="p">,</span> <span class="mf">0.49803922</span><span class="p">,</span> <span class="mf">0.05490196</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.17254902</span><span class="p">,</span> <span class="mf">0.62745098</span><span class="p">,</span> <span class="mf">0.17254902</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.83921569</span><span class="p">,</span> <span class="mf">0.15294118</span><span class="p">,</span> <span class="mf">0.15686275</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.58039216</span><span class="p">,</span> <span class="mf">0.40392157</span><span class="p">,</span> <span class="mf">0.74117647</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.54901961</span><span class="p">,</span> <span class="mf">0.3372549</span> <span class="p">,</span> <span class="mf">0.29411765</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.89019608</span><span class="p">,</span> <span class="mf">0.46666667</span><span class="p">,</span> <span class="mf">0.76078431</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.49803922</span><span class="p">,</span> <span class="mf">0.49803922</span><span class="p">,</span> <span class="mf">0.49803922</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.7372549</span> <span class="p">,</span> <span class="mf">0.74117647</span><span class="p">,</span> <span class="mf">0.13333333</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.09019608</span><span class="p">,</span> <span class="mf">0.74509804</span><span class="p">,</span> <span class="mf">0.81176471</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.4</span>       <span class="p">,</span> <span class="mf">0.76078431</span><span class="p">,</span> <span class="mf">0.64705882</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.98823529</span><span class="p">,</span> <span class="mf">0.55294118</span><span class="p">,</span> <span class="mf">0.38431373</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.55294118</span><span class="p">,</span> <span class="mf">0.62745098</span><span class="p">,</span> <span class="mf">0.79607843</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.90588235</span><span class="p">,</span> <span class="mf">0.54117647</span><span class="p">,</span> <span class="mf">0.76470588</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.65098039</span><span class="p">,</span> <span class="mf">0.84705882</span><span class="p">,</span> <span class="mf">0.32941176</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">1.</span>        <span class="p">,</span> <span class="mf">0.85098039</span><span class="p">,</span> <span class="mf">0.18431373</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.89803922</span><span class="p">,</span> <span class="mf">0.76862745</span><span class="p">,</span> <span class="mf">0.58039216</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.70196078</span><span class="p">,</span> <span class="mf">0.70196078</span><span class="p">,</span> <span class="mf">0.70196078</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.86</span>      <span class="p">,</span> <span class="mf">0.3712</span>    <span class="p">,</span> <span class="mf">0.34</span>      <span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.8288</span>    <span class="p">,</span> <span class="mf">0.86</span>      <span class="p">,</span> <span class="mf">0.34</span>      <span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.34</span>      <span class="p">,</span> <span class="mf">0.86</span>      <span class="p">,</span> <span class="mf">0.3712</span>    <span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.34</span>      <span class="p">,</span> <span class="mf">0.8288</span>    <span class="p">,</span> <span class="mf">0.86</span>      <span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.3712</span>    <span class="p">,</span> <span class="mf">0.34</span>      <span class="p">,</span> <span class="mf">0.86</span>      <span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.86</span>      <span class="p">,</span> <span class="mf">0.34</span>      <span class="p">,</span> <span class="mf">0.8288</span>    <span class="p">,</span> <span class="mf">1.</span>        <span class="p">]])</span>
 

<span class="n">core_colors_max_bright</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">core_colors</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">core_colors_min_bright</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">core_colors</span><span class="p">))</span><span class="o">*</span><span class="mf">0.5</span>

<span class="c1"># tab10 + Set2 + hls reversed</span>
<span class="n">patch_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.86</span>      <span class="p">,</span> <span class="mf">0.34</span>      <span class="p">,</span> <span class="mf">0.8288</span>    <span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.3712</span>    <span class="p">,</span> <span class="mf">0.34</span>      <span class="p">,</span> <span class="mf">0.86</span>      <span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.34</span>      <span class="p">,</span> <span class="mf">0.8288</span>    <span class="p">,</span> <span class="mf">0.86</span>      <span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.34</span>      <span class="p">,</span> <span class="mf">0.86</span>      <span class="p">,</span> <span class="mf">0.3712</span>    <span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.8288</span>    <span class="p">,</span> <span class="mf">0.86</span>      <span class="p">,</span> <span class="mf">0.34</span>      <span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.86</span>      <span class="p">,</span> <span class="mf">0.3712</span>    <span class="p">,</span> <span class="mf">0.34</span>      <span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.70196078</span><span class="p">,</span> <span class="mf">0.70196078</span><span class="p">,</span> <span class="mf">0.70196078</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.89803922</span><span class="p">,</span> <span class="mf">0.76862745</span><span class="p">,</span> <span class="mf">0.58039216</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">1.</span>        <span class="p">,</span> <span class="mf">0.85098039</span><span class="p">,</span> <span class="mf">0.18431373</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.65098039</span><span class="p">,</span> <span class="mf">0.84705882</span><span class="p">,</span> <span class="mf">0.32941176</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.90588235</span><span class="p">,</span> <span class="mf">0.54117647</span><span class="p">,</span> <span class="mf">0.76470588</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.55294118</span><span class="p">,</span> <span class="mf">0.62745098</span><span class="p">,</span> <span class="mf">0.79607843</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.98823529</span><span class="p">,</span> <span class="mf">0.55294118</span><span class="p">,</span> <span class="mf">0.38431373</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.4</span>       <span class="p">,</span> <span class="mf">0.76078431</span><span class="p">,</span> <span class="mf">0.64705882</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.09019608</span><span class="p">,</span> <span class="mf">0.74509804</span><span class="p">,</span> <span class="mf">0.81176471</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.7372549</span> <span class="p">,</span> <span class="mf">0.74117647</span><span class="p">,</span> <span class="mf">0.13333333</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.49803922</span><span class="p">,</span> <span class="mf">0.49803922</span><span class="p">,</span> <span class="mf">0.49803922</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.89019608</span><span class="p">,</span> <span class="mf">0.46666667</span><span class="p">,</span> <span class="mf">0.76078431</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.54901961</span><span class="p">,</span> <span class="mf">0.3372549</span> <span class="p">,</span> <span class="mf">0.29411765</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.58039216</span><span class="p">,</span> <span class="mf">0.40392157</span><span class="p">,</span> <span class="mf">0.74117647</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.83921569</span><span class="p">,</span> <span class="mf">0.15294118</span><span class="p">,</span> <span class="mf">0.15686275</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.17254902</span><span class="p">,</span> <span class="mf">0.62745098</span><span class="p">,</span> <span class="mf">0.17254902</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">1.</span>        <span class="p">,</span> <span class="mf">0.49803922</span><span class="p">,</span> <span class="mf">0.05490196</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">],</span>
   <span class="p">[</span><span class="mf">0.12156863</span><span class="p">,</span> <span class="mf">0.46666667</span><span class="p">,</span> <span class="mf">0.70588235</span><span class="p">,</span> <span class="mf">1.</span>        <span class="p">]])</span>

<span class="n">patch_colors_max_bright</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">patch_colors</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">patch_colors_min_bright</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">patch_colors</span><span class="p">))</span><span class="o">*</span><span class="mf">0.5</span>

<span class="c1">#%%</span>

<div class="viewcode-block" id="plot_compartments"><a class="viewcode-back" href="../../../Developers/Developer%20API/observables/plot_util.html#pyrid.observables.plot_util.plot_compartments">[docs]</a><span class="k">def</span> <span class="nf">plot_compartments</span><span class="p">(</span><span class="n">Simulation</span><span class="p">,</span> <span class="n">save_fig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">fig_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fig_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">comp_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">face_groups</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">show_normals</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">mol_traj</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">projection</span> <span class="o">=</span> <span class="s1">&#39;orthographic&#39;</span><span class="p">,</span> <span class="n">plot_cube</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">plane</span> <span class="o">=</span> <span class="s1">&#39;-xz&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;Plots the compartment meshes and highlights any face groups and borders/edges using the plotly library. Also plots the triangle normal vectors.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Simulation : `object`</span>
<span class="sd">        Instance of the Simulation class</span>
<span class="sd">    save_fig : `boolean`</span>
<span class="sd">        If True, the plot is exported to a .png file.</span>
<span class="sd">    fig_name : `string`</span>
<span class="sd">        Name of the figure</span>
<span class="sd">    fig_path : `string`</span>
<span class="sd">        Path to which the figure is exported</span>
<span class="sd">    comp_name : `string`</span>
<span class="sd">        Name of the compartment which to plot</span>
<span class="sd">    face_groups : `boolean`</span>
<span class="sd">        If True, the face groups of the compartment are highlighted</span>
<span class="sd">    show_normals : `boolean`</span>
<span class="sd">        If True, the triangle normal vectors are plotted</span>
<span class="sd">    mol_traj : `float64[T,N,3]`</span>
<span class="sd">        Molecule trajectories can be passed which are then plotted as lines in 3D. T is the number of time steps, N the number of molecules. Molecules whose trajectory to plot can also be selected in addition by the parameter indces.</span>
<span class="sd">    indices : `int64[:]`</span>
<span class="sd">        Indices of the molecules whose trajectory to plot</span>
<span class="sd">    projection : `string`</span>
<span class="sd">        Projection type. Default = `orthographic`</span>
<span class="sd">    plot_cube = `boolean`</span>
<span class="sd">        If True, the simualtion box is visualized in addition to the selected compartment</span>
<span class="sd">    plane : `string` (&#39;-xy&#39;, &#39;xy&#39;, &#39;-yz&#39;, &#39;yz&#39;, &#39;-xz&#39;, &#39;xz&#39;)</span>
<span class="sd">        Defines the plane to which the camera is oriented. Default = `-xz`</span>
<span class="sd">    alpha : `float64` in [0,1]</span>
<span class="sd">        Sets the opacity of the mesh faces.</span>
<span class="sd">    show : `boolean`</span>
<span class="sd">        If True, the plot is shown directly, otherwise only after the simualtion has ended.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">comp_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">comp_name</span> <span class="ow">in</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">compartments_name</span><span class="p">:</span>
            
            <span class="n">plot_compartment_0</span><span class="p">(</span><span class="n">Simulation</span><span class="p">,</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="p">,</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">Mesh</span><span class="p">[</span><span class="s1">&#39;triangles&#39;</span><span class="p">],</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">Compartments</span><span class="p">,</span> <span class="n">comp_name</span><span class="p">,</span> <span class="n">save_fig</span> <span class="o">=</span> <span class="n">save_fig</span><span class="p">,</span> <span class="n">fig_name</span> <span class="o">=</span> <span class="n">fig_name</span><span class="p">,</span> <span class="n">fig_path</span> <span class="o">=</span> <span class="n">fig_path</span><span class="p">,</span> <span class="n">face_groups</span> <span class="o">=</span> <span class="n">face_groups</span><span class="p">,</span> <span class="n">show_normals</span> <span class="o">=</span> <span class="n">show_normals</span><span class="p">,</span> <span class="n">mol_traj</span> <span class="o">=</span> <span class="n">mol_traj</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span><span class="p">,</span> <span class="n">projection</span> <span class="o">=</span> <span class="n">projection</span><span class="p">,</span> <span class="n">plot_cube</span> <span class="o">=</span> <span class="n">plot_cube</span><span class="p">,</span> <span class="n">plane</span> <span class="o">=</span> <span class="n">plane</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="n">show</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        
        <span class="n">plot_compartment_0</span><span class="p">(</span><span class="n">Simulation</span><span class="p">,</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="p">,</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">Mesh</span><span class="p">[</span><span class="s1">&#39;triangles&#39;</span><span class="p">],</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">Compartments</span><span class="p">,</span> <span class="n">comp_name</span><span class="p">,</span> <span class="n">save_fig</span> <span class="o">=</span> <span class="n">save_fig</span><span class="p">,</span> <span class="n">fig_name</span> <span class="o">=</span> <span class="n">fig_name</span><span class="p">,</span> <span class="n">fig_path</span> <span class="o">=</span> <span class="n">fig_path</span><span class="p">,</span> <span class="n">face_groups</span> <span class="o">=</span> <span class="n">face_groups</span><span class="p">,</span> <span class="n">show_normals</span> <span class="o">=</span> <span class="n">show_normals</span><span class="p">,</span> <span class="n">mol_traj</span> <span class="o">=</span> <span class="n">mol_traj</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span><span class="p">,</span> <span class="n">projection</span> <span class="o">=</span> <span class="n">projection</span><span class="p">,</span> <span class="n">plot_cube</span> <span class="o">=</span> <span class="n">plot_cube</span><span class="p">,</span> <span class="n">plane</span> <span class="o">=</span> <span class="n">plane</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="n">show</span><span class="p">)</span></div>

<span class="c1">#%%</span>

<div class="viewcode-block" id="plot_compartment_0"><a class="viewcode-back" href="../../../Developers/Developer%20API/observables/plot_util.html#pyrid.observables.plot_util.plot_compartment_0">[docs]</a><span class="k">def</span> <span class="nf">plot_compartment_0</span><span class="p">(</span><span class="n">Simulation</span><span class="p">,</span> <span class="n">System</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">triangles</span><span class="p">,</span> <span class="n">Compartments</span><span class="p">,</span> <span class="n">comp_name</span><span class="p">,</span> <span class="n">save_fig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">fig_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fig_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">face_groups</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">show_normals</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">mol_traj</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">projection</span> <span class="o">=</span> <span class="s1">&#39;orthographic&#39;</span><span class="p">,</span> <span class="n">plot_cube</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">plane</span> <span class="o">=</span> <span class="s1">&#39;-xz&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;A brief description of what the function (method in case of classes) is and what itâ€™s used for</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameter_1 : dtype</span>
<span class="sd">        Some Information</span>
<span class="sd">    parameter_2 : dtype</span>
<span class="sd">        Some Information</span>
<span class="sd">    </span>
<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    NotImplementedError (just an example)</span>
<span class="sd">        Brief explanation of why/when this exception is raised</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dtype</span>
<span class="sd">        Some information</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    https://chart-studio.plotly.com/~empet/14749/mesh3d-with-intensities-and-flatshading/#/</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">comp_name</span><span class="o">!=</span><span class="s1">&#39;Box&#39;</span><span class="p">:</span>
        <span class="n">comp_id</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">compartments_id</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">comp_name</span><span class="p">)]</span>
        
        <span class="n">triangle_ids</span> <span class="o">=</span> <span class="n">Compartments</span><span class="p">[</span><span class="n">comp_id</span><span class="p">]</span><span class="o">.</span><span class="n">triangle_ids</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">triangle_ids</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">triangle_ids</span>
        
    <span class="c1">#----------------</span>
    
    <span class="n">mygrey</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rgb(153, 153, 153)&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="s1">&#39;rgb(255,255,255)&#39;</span><span class="p">]</span>
    <span class="n">myred</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rgb(153, 0, 0)&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="s1">&#39;rgb(255,0,0)&#39;</span><span class="p">]</span>
    <span class="n">mygreen</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rgb(0, 153, 0)&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="s1">&#39;rgb(0,255,0)&#39;</span><span class="p">]</span>
    <span class="n">myblue</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rgb(0, 0, 153)&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="s1">&#39;rgb(0,0,255)&#39;</span><span class="p">]</span>
    <span class="n">mymagenta</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rgb(153, 0, 153)&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="s1">&#39;rgb(255,0,255)&#39;</span><span class="p">]</span>
    <span class="n">myyellow</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rgb(153, 153, 0)&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="s1">&#39;rgb(255,255,0)&#39;</span><span class="p">]</span>
    
    <span class="n">cone_color</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rgb(0, 70, 0)&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rgb(0, 70, 0)&#39;</span><span class="p">]</span>
    
    <span class="c1">#----------------</span>
    
    <span class="n">face_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;rgb(153, 153, 153)&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">triangle_ids</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="c1">#----------------</span>
    
    <span class="k">if</span> <span class="n">comp_name</span><span class="o">!=</span><span class="s1">&#39;Box&#39;</span><span class="p">:</span>
        
        <span class="n">x_cube</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">y_cube</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">z_cube</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span>
        
        <span class="n">i_cube</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">j_cube</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">k_cube</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
        
        <span class="n">Cube</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Mesh3d</span><span class="p">(</span>
            <span class="c1"># 8 vertices of a cube</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x_cube</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y_cube</span><span class="p">,</span>
            <span class="n">z</span><span class="o">=</span><span class="n">z_cube</span><span class="p">,</span>
            <span class="n">colorscale</span><span class="o">=</span><span class="n">mygrey</span><span class="p">,</span> 
            <span class="n">intensity</span> <span class="o">=</span> <span class="n">z_cube</span><span class="p">,</span>
            <span class="n">flatshading</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i_cube</span><span class="p">,</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">j_cube</span><span class="p">,</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">k_cube</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Simulation box&#39;</span><span class="p">,</span>
            <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        
        <span class="n">Cube</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cmin</span><span class="o">=-</span><span class="mi">7</span><span class="p">,</span><span class="c1"># atrick to get a nice plot (z.min()=-3.31909)</span>
                       <span class="n">lighting</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ambient</span><span class="o">=</span><span class="mf">0.18</span><span class="p">,</span>
                                     <span class="n">diffuse</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                     <span class="n">fresnel</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                     <span class="n">specular</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                     <span class="n">roughness</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                                     <span class="n">facenormalsepsilon</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">,</span>
                                     <span class="n">vertexnormalsepsilon</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">),</span>
                       <span class="n">lightposition</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                          <span class="n">y</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                                          <span class="n">z</span><span class="o">=</span><span class="mi">0</span>
                                         <span class="p">),</span>
                       <span class="n">opacity</span> <span class="o">=</span> <span class="mf">0.1</span>
                              <span class="p">);</span>

    <span class="c1">#----------------</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        
    <span class="c1"># ----------------------------------</span>
    
    <span class="k">if</span> <span class="n">comp_name</span><span class="o">!=</span><span class="s1">&#39;Box&#39;</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="n">face_groups</span><span class="p">:</span>
        
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Compartments</span><span class="p">[</span><span class="n">comp_id</span><span class="p">]</span><span class="o">.</span><span class="n">border_2d</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            
                <span class="n">Xe</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">Ye</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">Ze</span> <span class="o">=</span> <span class="p">[]</span>
            
                <span class="n">Xe_dir</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">Ye_dir</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">Ze_dir</span> <span class="o">=</span> <span class="p">[]</span>
                
                <span class="n">Xe_cone</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">Ye_cone</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">Ze_cone</span> <span class="o">=</span> <span class="p">[]</span>
                
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Compartments</span><span class="p">[</span><span class="n">comp_id</span><span class="p">]</span><span class="o">.</span><span class="n">border_2d</span><span class="p">)):</span>
                    
                    <span class="n">border_tri</span> <span class="o">=</span> <span class="n">Compartments</span><span class="p">[</span><span class="n">comp_id</span><span class="p">]</span><span class="o">.</span><span class="n">border_2d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;triangle_ids&#39;</span><span class="p">]</span>
                    
                    <span class="n">edge_id</span> <span class="o">=</span> <span class="n">Compartments</span><span class="p">[</span><span class="n">comp_id</span><span class="p">]</span><span class="o">.</span><span class="n">border_2d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;edge_id&#39;</span><span class="p">]</span>
                    
                    <span class="n">direction</span> <span class="o">=</span> <span class="n">Compartments</span><span class="p">[</span><span class="n">comp_id</span><span class="p">]</span><span class="o">.</span><span class="n">border_2d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;direction_normal&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">scale</span><span class="o">/</span><span class="mi">10</span>
                    
                    <span class="n">e0</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">Mesh</span><span class="p">[</span><span class="n">border_tri</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">edge_id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">e1</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">Mesh</span><span class="p">[</span><span class="n">border_tri</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">edge_id</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    
                    <span class="n">p0</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">e0</span><span class="p">]</span>
                    <span class="n">p1</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">e1</span><span class="p">]</span>
                    
                    <span class="n">Xe</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">+</span><span class="p">[</span> <span class="kc">None</span><span class="p">])</span>
                    <span class="n">Ye</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">+</span><span class="p">[</span> <span class="kc">None</span><span class="p">])</span>
                    <span class="n">Ze</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">p0</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">+</span><span class="p">[</span> <span class="kc">None</span><span class="p">])</span>
                    
                    <span class="n">Xe_dir</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">direction</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">+</span><span class="p">[</span> <span class="kc">None</span><span class="p">])</span>
                    <span class="n">Ye_dir</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">direction</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">+</span><span class="p">[</span> <span class="kc">None</span><span class="p">])</span>
                    <span class="n">Ze_dir</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">p0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">p0</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">p0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">p0</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">direction</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">+</span><span class="p">[</span> <span class="kc">None</span><span class="p">])</span>
                    
                    <span class="n">Xe_cone</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">direction</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                    <span class="n">Ye_cone</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">direction</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                    <span class="n">Ze_cone</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">p0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">p0</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">p0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">p0</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">direction</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
                        
                <span class="n">Xe_cone</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Xe_cone</span><span class="p">)</span>
                <span class="n">Ye_cone</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Ye_cone</span><span class="p">)</span>
                <span class="n">Ze_cone</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Ze_cone</span><span class="p">)</span>
                
                <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">Xe_cone</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">Ye_cone</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">Ze_cone</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
                
                <span class="n">cone_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                
                <span class="n">u</span><span class="o">/=</span><span class="n">cone_norm</span>
                <span class="n">v</span><span class="o">/=</span><span class="n">cone_norm</span>
                <span class="n">w</span><span class="o">/=</span><span class="n">cone_norm</span>
                
                <span class="n">edges</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span>
                                   <span class="n">x</span><span class="o">=</span><span class="n">Xe</span><span class="p">,</span>
                                   <span class="n">y</span><span class="o">=</span><span class="n">Ye</span><span class="p">,</span>
                                   <span class="n">z</span><span class="o">=</span><span class="n">Ze</span><span class="p">,</span>
                                   <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
                                   <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                   <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span> <span class="s1">&#39;rgb(153, 0, 153)&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>  
                    
                <span class="n">directions</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span>
                                   <span class="n">x</span><span class="o">=</span><span class="n">Xe_dir</span><span class="p">,</span>
                                   <span class="n">y</span><span class="o">=</span><span class="n">Ye_dir</span><span class="p">,</span>
                                   <span class="n">z</span><span class="o">=</span><span class="n">Ze_dir</span><span class="p">,</span>
                                   <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
                                   <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                   <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span> <span class="s1">&#39;rgb(0,70,0)&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>  
                
                <span class="n">cones</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Cone</span><span class="p">(</span>
                                <span class="n">x</span><span class="o">=</span><span class="n">Xe_cone</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">y</span><span class="o">=</span><span class="n">Ye_cone</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">z</span><span class="o">=</span><span class="n">Ze_cone</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span>
                                <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">,</span>
                                <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">,</span>
                                <span class="n">sizemode</span><span class="o">=</span><span class="s2">&quot;absolute&quot;</span><span class="p">,</span>
                                <span class="n">sizeref</span><span class="o">=</span><span class="n">scale</span><span class="o">/</span><span class="mi">300</span><span class="p">,</span>
                                <span class="n">anchor</span><span class="o">=</span><span class="s2">&quot;tail&quot;</span><span class="p">,</span>
                                <span class="n">colorscale</span><span class="o">=</span><span class="n">cone_color</span><span class="p">,</span>
                                <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                
                
                
                <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">edges</span><span class="p">,</span> <span class="n">directions</span><span class="p">,</span> <span class="n">cones</span><span class="p">])</span>
            
            
            <span class="c1">#-----------------------</span>
            
            
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Compartments</span><span class="p">[</span><span class="n">comp_id</span><span class="p">]</span><span class="o">.</span><span class="n">border_2d</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">triangle_ids_group</span> <span class="o">=</span> <span class="n">Compartments</span><span class="p">[</span><span class="n">comp_id</span><span class="p">]</span><span class="o">.</span><span class="n">border_2d</span><span class="p">[</span><span class="s1">&#39;triangle_ids&#39;</span><span class="p">]</span>
                
                
                <span class="n">face_colors</span><span class="p">[</span><span class="n">triangle_ids_group</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;rgb(153, 0, 0)&#39;</span>
                
                
            <span class="c1"># if len(Compartments[comp_id].border_3d)&gt;0:</span>
            <span class="c1">#     triangle_ids_group = Compartments[comp_id].border_3d[&#39;triangle_ids&#39;]</span>
                
            <span class="c1">#     face_colors[triangle_ids_group] = &#39;rgb(153, 153, 0)&#39;</span>
                
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Compartments</span><span class="p">[</span><span class="n">comp_id</span><span class="p">]</span><span class="o">.</span><span class="n">groups</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">Compartments</span><span class="p">[</span><span class="n">comp_id</span><span class="p">]</span><span class="o">.</span><span class="n">groups</span><span class="p">:</span>
                    <span class="n">triangle_ids_group</span> <span class="o">=</span> <span class="n">Compartments</span><span class="p">[</span><span class="n">comp_id</span><span class="p">]</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="s1">&#39;triangle_ids&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">group</span> <span class="o">==</span> <span class="s1">&#39;transparent&#39;</span><span class="p">:</span>
                        <span class="n">face_colors</span><span class="p">[</span><span class="n">triangle_ids_group</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;rgb(153, 153, 0)&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">face_colors</span><span class="p">[</span><span class="n">triangle_ids_group</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;rgb(0, 0, 153)&#39;</span>
    
    <span class="k">else</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">System</span><span class="o">.</span><span class="n">box_border</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">triangle_ids_group</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">box_border</span><span class="p">[</span><span class="s1">&#39;triangle_ids&#39;</span><span class="p">]</span>
            
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            
            <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">triangles</span><span class="p">)[</span><span class="n">triangle_ids_group</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">triangles</span><span class="p">)[</span><span class="n">triangle_ids_group</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">triangles</span><span class="p">)[</span><span class="n">triangle_ids_group</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            
            <span class="c1"># lighting_effects = dict(ambient=0.4, diffuse=0.5, roughness = 0.9, specular=0.6, fresnel=0.2)</span>
            
                                       
            <span class="n">group_mesh</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Mesh3d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                                <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                                <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
                                <span class="n">colorscale</span><span class="o">=</span><span class="n">myyellow</span><span class="p">,</span> 
                                <span class="n">intensity</span><span class="o">=</span> <span class="n">z</span><span class="p">,</span>
                                <span class="n">flatshading</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">i</span><span class="o">=</span><span class="n">I</span><span class="p">,</span>
                                <span class="n">j</span><span class="o">=</span><span class="n">J</span><span class="p">,</span>
                                <span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">,</span>
                                <span class="n">name</span><span class="o">=</span><span class="n">comp_name</span><span class="p">,</span>
                                <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span>
                                <span class="p">)</span>
            
            <span class="n">group_mesh</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cmin</span><span class="o">=-</span><span class="mi">7</span><span class="p">,</span><span class="c1"># atrick to get a nice plot (z.min()=-3.31909)</span>
                            <span class="n">lighting</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ambient</span><span class="o">=</span><span class="mf">0.18</span><span class="p">,</span>
                                          <span class="n">diffuse</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                          <span class="n">fresnel</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                          <span class="n">specular</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                          <span class="n">roughness</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                                          <span class="n">facenormalsepsilon</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">,</span>
                                          <span class="n">vertexnormalsepsilon</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">),</span>
                            <span class="n">lightposition</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                              <span class="n">y</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                                              <span class="n">z</span><span class="o">=</span><span class="mi">0</span>
                                              <span class="p">),</span>
                            <span class="n">opacity</span> <span class="o">=</span> <span class="mf">0.5</span>
                                  <span class="p">);</span>
        
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group_mesh</span><span class="p">)</span>
            
            
    <span class="c1">#-----------------------</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">triangles</span><span class="p">)[</span><span class="n">triangle_ids</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">triangles</span><span class="p">)[</span><span class="n">triangle_ids</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">triangles</span><span class="p">)[</span><span class="n">triangle_ids</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="c1"># lighting_effects = dict(ambient=0.4, diffuse=0.5, roughness = 0.9, specular=0.6, fresnel=0.2)</span>
    
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Mesh3d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                        <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
                        <span class="c1"># colorscale=mygrey, </span>
                        <span class="c1"># intensity= z,</span>
                        <span class="n">facecolor</span> <span class="o">=</span> <span class="n">face_colors</span><span class="p">[</span><span class="n">triangle_ids</span><span class="p">],</span>
                        <span class="n">flatshading</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">i</span><span class="o">=</span><span class="n">I</span><span class="p">,</span>
                        <span class="n">j</span><span class="o">=</span><span class="n">J</span><span class="p">,</span>
                        <span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">comp_name</span><span class="p">,</span>
                        <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span>
                        <span class="p">)</span>
    
    <span class="k">if</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;perspective&#39;</span><span class="p">:</span>
        <span class="n">ambient</span> <span class="o">=</span> <span class="mf">0.18</span>
        <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">opacity</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># 0.5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">opacity</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="n">fresnel</span><span class="o">=</span><span class="mf">0.1</span>
        <span class="n">x_light</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">y_light</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="n">z_light</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ambient</span> <span class="o">=</span> <span class="mf">0.28</span>
        <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">opacity</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># 0.8</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">opacity</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="n">fresnel</span><span class="o">=</span><span class="mf">0.5</span>
        <span class="n">x_light</span> <span class="o">=</span> <span class="mi">20000</span>
        <span class="n">y_light</span> <span class="o">=</span> <span class="mi">100000</span>
        <span class="n">z_light</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
        
    <span class="n">mesh</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cmin</span><span class="o">=-</span><span class="mi">7</span><span class="p">,</span><span class="c1"># atrick to get a nice plot (z.min()=-3.31909)</span>
                   <span class="n">lighting</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ambient</span><span class="o">=</span><span class="n">ambient</span><span class="p">,</span>
                                 <span class="n">diffuse</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                 <span class="n">fresnel</span><span class="o">=</span><span class="n">fresnel</span><span class="p">,</span>
                                 <span class="n">specular</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                 <span class="n">roughness</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                                 <span class="n">facenormalsepsilon</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">,</span>
                                 <span class="n">vertexnormalsepsilon</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">),</span>
                   <span class="n">lightposition</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_light</span><span class="p">,</span>
                                      <span class="n">y</span><span class="o">=</span><span class="n">y_light</span><span class="p">,</span>
                                      <span class="n">z</span><span class="o">=</span><span class="n">z_light</span>
                                     <span class="p">),</span>
                   <span class="n">opacity</span> <span class="o">=</span> <span class="n">opacity</span>
                          <span class="p">);</span>
    
    
    
    <span class="n">tri_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertices</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">triangles</span><span class="p">)[</span><span class="n">triangle_ids</span><span class="p">]]</span>
    
    <span class="c1">#extract the lists of x, y, z coordinates of the triangle vertices and connect them by a line</span>
    <span class="n">Xe</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Ye</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Ze</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">T</span> <span class="ow">in</span> <span class="n">tri_points</span><span class="p">:</span>
        <span class="n">Xe</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">T</span><span class="p">[</span><span class="n">k</span><span class="o">%</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span><span class="o">+</span><span class="p">[</span> <span class="kc">None</span><span class="p">])</span>
        <span class="n">Ye</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">T</span><span class="p">[</span><span class="n">k</span><span class="o">%</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span><span class="o">+</span><span class="p">[</span> <span class="kc">None</span><span class="p">])</span>
        <span class="n">Ze</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">T</span><span class="p">[</span><span class="n">k</span><span class="o">%</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span><span class="o">+</span><span class="p">[</span> <span class="kc">None</span><span class="p">])</span>
    
    <span class="n">lines</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span>
                       <span class="n">x</span><span class="o">=</span><span class="n">Xe</span><span class="p">,</span>
                       <span class="n">y</span><span class="o">=</span><span class="n">Ye</span><span class="p">,</span>
                       <span class="n">z</span><span class="o">=</span><span class="n">Ze</span><span class="p">,</span>
                       <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
                       <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                       <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span> <span class="s1">&#39;rgb(70,70,70)&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>  
    
    
    <span class="c1"># ----------------------------------</span>
    <span class="k">if</span> <span class="n">comp_name</span><span class="o">!=</span><span class="s1">&#39;Box&#39;</span> <span class="ow">and</span> <span class="n">plot_cube</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">mesh</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">Cube</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">mesh</span><span class="p">,</span> <span class="n">lines</span><span class="p">])</span>
        
    <span class="c1">#-----------------------</span>
    
    <span class="k">if</span> <span class="n">show_normals</span><span class="p">:</span>
        
        <span class="n">Xe_norm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Ye_norm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Ze_norm</span> <span class="o">=</span> <span class="p">[]</span>
    
        
        <span class="k">for</span> <span class="n">tri_id</span> <span class="ow">in</span> <span class="n">triangle_ids</span><span class="p">:</span>
            
            <span class="n">centroid</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">Mesh</span><span class="p">[</span><span class="n">tri_id</span><span class="p">][</span><span class="s1">&#39;triangle_centroid&#39;</span><span class="p">]</span>
            <span class="n">normal</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">Mesh</span><span class="p">[</span><span class="n">tri_id</span><span class="p">][</span><span class="s1">&#39;triangle_coord&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">scale</span><span class="o">/</span><span class="mi">20</span>
            
            
            <span class="n">Xe_norm</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">centroid</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">centroid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">normal</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">+</span><span class="p">[</span> <span class="kc">None</span><span class="p">])</span>
            <span class="n">Ye_norm</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">centroid</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">centroid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">normal</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">+</span><span class="p">[</span> <span class="kc">None</span><span class="p">])</span>
            <span class="n">Ze_norm</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">centroid</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">centroid</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">normal</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">+</span><span class="p">[</span> <span class="kc">None</span><span class="p">])</span>
            
        <span class="n">normals</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span>
                           <span class="n">x</span><span class="o">=</span><span class="n">Xe_norm</span><span class="p">,</span>
                           <span class="n">y</span><span class="o">=</span><span class="n">Ye_norm</span><span class="p">,</span>
                           <span class="n">z</span><span class="o">=</span><span class="n">Ze_norm</span><span class="p">,</span>
                           <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
                           <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                           <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span> <span class="s1">&#39;rgb(0,0,0)&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>  
    
        <span class="n">data</span> <span class="o">+=</span> <span class="p">[</span><span class="n">normals</span><span class="p">]</span>
        
    <span class="c1">#-----------------------</span>
    
    <span class="k">if</span> <span class="n">mol_traj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mol_traj</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                
            <span class="n">x</span> <span class="o">=</span> <span class="n">mol_traj</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">mol_traj</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">mol_traj</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
            
            <span class="n">mol_trace</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span>
                <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;rgb(255,0,0)&#39;</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="mi">8</span>
                <span class="p">)</span>
            <span class="p">)</span>
        
            <span class="n">data</span> <span class="o">+=</span> <span class="p">[</span><span class="n">mol_trace</span><span class="p">]</span>
    <span class="c1">#-----------------------</span>
    
    
    <span class="n">layout</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
             <span class="c1">#title=comp_name,</span>
             <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">),</span>
             <span class="n">paper_bgcolor</span><span class="o">=</span><span class="s1">&#39;rgb(255,255,255)&#39;</span><span class="p">,</span>
             <span class="c1">#titlefont=dict(size=24, color=&#39;black&#39;), </span>
             <span class="c1">#width = 2000, </span>
             <span class="c1">#height = 2000,</span>
             <span class="c1">#margin=dict(l=400, r=400, t=100, b=100),</span>
             <span class="n">scene</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">camera</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">projection</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span> <span class="o">=</span> <span class="n">projection</span><span class="p">))),</span>
            <span class="p">)</span>
        
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>
    
    <span class="n">x_visibility</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">y_visibility</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">z_visibility</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="s1">&#39;xz&#39;</span> <span class="ow">in</span> <span class="n">plane</span><span class="p">:</span>
        <span class="n">camera</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">eye</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">plane</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;1&#39;</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">y_visibility</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="s1">&#39;xy&#39;</span> <span class="ow">in</span> <span class="n">plane</span><span class="p">:</span>
        <span class="n">camera</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">eye</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">plane</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;1&#39;</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">z_visibility</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="s1">&#39;yz&#39;</span> <span class="ow">in</span> <span class="n">plane</span><span class="p">:</span>
        <span class="n">camera</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">eye</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">plane</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;1&#39;</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">x_visibility</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">scene</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span>
                    <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span>
                    <span class="n">zaxis_title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span>
                    <span class="n">xaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">showgrid</span> <span class="o">=</span>  <span class="kc">True</span><span class="p">,</span>
                                 <span class="n">visible</span> <span class="o">=</span> <span class="n">x_visibility</span><span class="p">,</span>
                                 <span class="n">showline</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                 <span class="n">backgroundcolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
                                 <span class="n">gridcolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                 <span class="n">showbackground</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                 <span class="n">zerolinecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">),</span>
                    <span class="n">yaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">showgrid</span> <span class="o">=</span>  <span class="kc">True</span><span class="p">,</span>
                                 <span class="n">visible</span> <span class="o">=</span> <span class="n">y_visibility</span><span class="p">,</span>
                                 <span class="n">showline</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                 <span class="n">backgroundcolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
                                 <span class="n">gridcolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                 <span class="n">showbackground</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                 <span class="n">zerolinecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">),</span>
                    <span class="n">zaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">showgrid</span> <span class="o">=</span>  <span class="kc">True</span><span class="p">,</span>
                                 <span class="n">visible</span> <span class="o">=</span> <span class="n">z_visibility</span><span class="p">,</span>
                                 <span class="n">showline</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                 <span class="n">backgroundcolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
                                 <span class="n">gridcolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                 <span class="n">showbackground</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                 <span class="n">zerolinecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">),</span>
                    <span class="p">),</span>
                    <span class="c1">#width = 2000, </span>
                    <span class="c1">#height = 2000,</span>
                    <span class="n">autosize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">t</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                                <span class="n">pad</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                    <span class="n">scene_camera</span><span class="o">=</span><span class="n">camera</span><span class="p">,</span>
                    <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="p">)</span>
    
    
    <span class="c1"># if projection == &#39;orthographic&#39;:</span>
    <span class="c1">#     fig.update_yaxes(visible=False)</span>
    
    
    <span class="k">if</span> <span class="n">save_fig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fig_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig_name</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">file_name</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">fig_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig_path</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">fig_path</span>
        
        <span class="n">fig</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="n">fig_path</span> <span class="o">/</span> <span class="p">(</span><span class="n">fig_name</span><span class="o">+</span><span class="s1">&#39;_Compartment_&#39;</span><span class="o">+</span><span class="n">comp_name</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#, engine=&#39;kaleido&#39;) </span>
        
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  </div>


<span class="c1">#%%</span>

<div class="viewcode-block" id="plot_scene"><a class="viewcode-back" href="../../../Developers/Developer%20API/observables/plot_util.html#pyrid.observables.plot_util.plot_scene">[docs]</a><span class="k">def</span> <span class="nf">plot_scene</span><span class="p">(</span><span class="n">Simulation</span><span class="p">,</span> <span class="n">save_fig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">fig_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fig_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">projection</span> <span class="o">=</span> <span class="s1">&#39;orthographic&#39;</span><span class="p">,</span> <span class="n">plane</span> <span class="o">=</span> <span class="s1">&#39;-xz&#39;</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;Plots the simulation scence with all its compartments and molecule positions. Molecule positions are represented by a scatter plot.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Simulation : `object`</span>
<span class="sd">        Instance of the Simulation class</span>
<span class="sd">    save_fig : `boolean`</span>
<span class="sd">        If True, the plot is exported to a .png file.</span>
<span class="sd">    fig_name : `string`</span>
<span class="sd">        Name of the figure</span>
<span class="sd">    fig_path : `string`</span>
<span class="sd">        Path to which the figure is exported</span>
<span class="sd">    projection : `string`</span>
<span class="sd">        Projection type. Default = `orthographic`</span>
<span class="sd">    plane : `string` (&#39;-xy&#39;, &#39;xy&#39;, &#39;-yz&#39;, &#39;yz&#39;, &#39;-xz&#39;, &#39;xz&#39;)</span>
<span class="sd">        Defines the plane to which the camera is oriented. Default = `-xz`</span>
<span class="sd">    show : `boolean`</span>
<span class="sd">        If True, the plot is shown directly, otherwise only after the simualtion has ended.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># https://chart-studio.plotly.com/~empet/14749/mesh3d-with-intensities-and-flatshading/#/</span>
    
    <span class="k">if</span> <span class="n">fig_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig_name</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">file_name</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span>
            
    <span class="k">if</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">RBs</span><span class="o">.</span><span class="n">occupied</span><span class="o">.</span><span class="n">n</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
    
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">Compartments</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">vertices</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">vertices</span>
            <span class="n">triangle_ids</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">triangle_ids</span>
            <span class="n">triangles</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">Mesh</span><span class="p">[</span><span class="n">triangle_ids</span><span class="p">][</span><span class="s1">&#39;triangles&#39;</span><span class="p">]</span>
            <span class="c1"># molecules = Simulation.RBs[0:][&#39;pos&#39;]</span>
            <span class="c1"># type_ids = Simulation.RBs[0:][&#39;type_id&#39;]</span>
        
        <span class="n">molecules</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">type_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">RBs</span><span class="o">.</span><span class="n">occupied</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">RBs</span><span class="o">.</span><span class="n">occupied</span><span class="p">[</span><span class="n">i0</span><span class="p">]</span> 
            <span class="n">molecules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">RBs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>
            <span class="n">type_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">RBs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;type_id&#39;</span><span class="p">])</span>
        <span class="n">molecules</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">molecules</span><span class="p">)</span>
        <span class="n">type_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">type_ids</span><span class="p">)</span>
        
        <span class="n">Diameter_Types</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">molecule_id_to_name</span><span class="p">:</span>
            <span class="n">Diameter_Types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">molecule_types</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">mol</span><span class="p">)]</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>
        <span class="n">Diameter_Types</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Diameter_Types</span><span class="p">)</span>
        <span class="n">Diameter</span> <span class="o">=</span> <span class="n">Diameter_Types</span><span class="p">[</span><span class="n">type_ids</span><span class="p">]</span>
        
        <span class="c1"># Radii*=10/np.min(Radii_Types)+1</span>
        
        <span class="c1">#----------------</span>
        
        <span class="n">mygrey</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rgb(153, 153, 153)&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="s1">&#39;rgb(255,255,255)&#39;</span><span class="p">]</span>
        
        <span class="n">x_cube</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">y_cube</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">z_cube</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span>
        
        <span class="n">i_cube</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">j_cube</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">k_cube</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
        
        <span class="n">Cube</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Mesh3d</span><span class="p">(</span>
            <span class="c1"># 8 vertices of a cube</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x_cube</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y_cube</span><span class="p">,</span>
            <span class="n">z</span><span class="o">=</span><span class="n">z_cube</span><span class="p">,</span>
            <span class="n">colorscale</span><span class="o">=</span><span class="n">mygrey</span><span class="p">,</span> 
            <span class="n">intensity</span> <span class="o">=</span> <span class="n">z_cube</span><span class="p">,</span>
            <span class="n">flatshading</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i_cube</span><span class="p">,</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">j_cube</span><span class="p">,</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">k_cube</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Simulation box&#39;</span><span class="p">,</span>
            <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        
        <span class="n">Cube</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cmin</span><span class="o">=-</span><span class="mi">7</span><span class="p">,</span><span class="c1"># atrick to get a nice plot (z.min()=-3.31909)</span>
                       <span class="n">lighting</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ambient</span><span class="o">=</span><span class="mf">0.18</span><span class="p">,</span>
                                     <span class="n">diffuse</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                     <span class="n">fresnel</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                     <span class="n">specular</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                     <span class="n">roughness</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                                     <span class="n">facenormalsepsilon</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">,</span>
                                     <span class="n">vertexnormalsepsilon</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">),</span>
                       <span class="n">lightposition</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                          <span class="n">y</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                                          <span class="n">z</span><span class="o">=</span><span class="mi">0</span>
                                         <span class="p">),</span>
                       <span class="n">opacity</span> <span class="o">=</span> <span class="mf">0.1</span>
                              <span class="p">);</span>
        
        <span class="c1">#----------------</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">Compartments</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            
            <span class="n">x</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            
            <span class="n">I</span> <span class="o">=</span> <span class="n">triangles</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">J</span> <span class="o">=</span> <span class="n">triangles</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">K</span> <span class="o">=</span> <span class="n">triangles</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            
            <span class="c1"># lighting_effects = dict(ambient=0.4, diffuse=0.5, roughness = 0.9, specular=0.6, fresnel=0.2)</span>
            
                                       
            <span class="n">mesh</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Mesh3d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                                <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                                <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
                                <span class="n">colorscale</span><span class="o">=</span><span class="n">mygrey</span><span class="p">,</span> 
                                <span class="n">intensity</span><span class="o">=</span> <span class="n">z</span><span class="p">,</span>
                                <span class="n">flatshading</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">i</span><span class="o">=</span><span class="n">I</span><span class="p">,</span>
                                <span class="n">j</span><span class="o">=</span><span class="n">J</span><span class="p">,</span>
                                <span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">,</span>
                                <span class="n">name</span><span class="o">=</span><span class="n">fig_name</span><span class="p">,</span>
                                <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span>
                                <span class="p">)</span>
            
            <span class="n">mesh</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cmin</span><span class="o">=-</span><span class="mi">7</span><span class="p">,</span><span class="c1"># atrick to get a nice plot (z.min()=-3.31909)</span>
                           <span class="n">lighting</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ambient</span><span class="o">=</span><span class="mf">0.18</span><span class="p">,</span>
                                         <span class="n">diffuse</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                         <span class="n">fresnel</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                         <span class="n">specular</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                         <span class="n">roughness</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                                         <span class="n">facenormalsepsilon</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">,</span>
                                         <span class="n">vertexnormalsepsilon</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">),</span>
                           <span class="n">lightposition</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                              <span class="n">y</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                                              <span class="n">z</span><span class="o">=</span><span class="mi">0</span>
                                             <span class="p">),</span>
                           <span class="n">opacity</span> <span class="o">=</span> <span class="mf">0.5</span>
                                  <span class="p">);</span>
            
            
            
            <span class="n">tri_points</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">triangles</span><span class="p">]</span>
            
            <span class="c1">#extract the lists of x, y, z coordinates of the triangle vertices and connect them by a line</span>
            <span class="n">Xe</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Ye</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Ze</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">T</span> <span class="ow">in</span> <span class="n">tri_points</span><span class="p">:</span>
                <span class="n">Xe</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">T</span><span class="p">[</span><span class="n">k</span><span class="o">%</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span><span class="o">+</span><span class="p">[</span> <span class="kc">None</span><span class="p">])</span>
                <span class="n">Ye</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">T</span><span class="p">[</span><span class="n">k</span><span class="o">%</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span><span class="o">+</span><span class="p">[</span> <span class="kc">None</span><span class="p">])</span>
                <span class="n">Ze</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">T</span><span class="p">[</span><span class="n">k</span><span class="o">%</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span><span class="o">+</span><span class="p">[</span> <span class="kc">None</span><span class="p">])</span>
            
            <span class="n">lines</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span>
                               <span class="n">x</span><span class="o">=</span><span class="n">Xe</span><span class="p">,</span>
                               <span class="n">y</span><span class="o">=</span><span class="n">Ye</span><span class="p">,</span>
                               <span class="n">z</span><span class="o">=</span><span class="n">Ze</span><span class="p">,</span>
                               <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
                               <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                               <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span> <span class="s1">&#39;rgb(70,70,70)&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>  
            
            
            
            <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">Cube</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">lines</span><span class="p">]</span>
            
        <span class="k">else</span><span class="p">:</span>
            
            <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">Cube</span><span class="p">]</span>
        
        
        <span class="n">layout</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
                 <span class="n">title</span><span class="o">=</span><span class="n">Simulation</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span>
                 <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">),</span>
                 <span class="c1"># width=700,</span>
                 <span class="c1"># height=700,</span>
                 <span class="c1"># scene_xaxis_visible=False,</span>
                 <span class="c1"># scene_yaxis_visible=False,</span>
                 <span class="c1"># scene_zaxis_visible=False,</span>
                 <span class="n">paper_bgcolor</span><span class="o">=</span><span class="s1">&#39;rgb(255,255,255)&#39;</span><span class="p">,</span>
                 <span class="n">scene</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">camera</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">projection</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span> <span class="o">=</span> <span class="n">projection</span><span class="p">))),</span>
               
                <span class="p">)</span>
        

            
        <span class="k">for</span> <span class="n">rb_id</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">type_ids</span><span class="p">):</span>
            
            <span class="n">Mask</span> <span class="o">=</span> <span class="n">type_ids</span> <span class="o">==</span> <span class="n">rb_id</span>
            
            <span class="n">xP</span> <span class="o">=</span> <span class="n">molecules</span><span class="p">[</span><span class="n">Mask</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">yP</span> <span class="o">=</span> <span class="n">molecules</span><span class="p">[</span><span class="n">Mask</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">zP</span> <span class="o">=</span> <span class="n">molecules</span><span class="p">[</span><span class="n">Mask</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
            
            <span class="n">points</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xP</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">yP</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">zP</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">molecule_id_to_name</span><span class="p">[</span><span class="n">rb_id</span><span class="p">],</span>  
                 <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                 <span class="n">size</span><span class="o">=</span><span class="n">Diameter</span><span class="p">[</span><span class="n">Mask</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Diameter</span><span class="p">)</span><span class="o">/</span><span class="mi">15</span><span class="p">),</span>
                 <span class="c1"># sizemode=&#39;diameter&#39;,</span>
                 <span class="c1"># sizeref=np.max(Diameter)/30,</span>
                 <span class="n">sizemin</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                 <span class="n">color</span><span class="o">=</span><span class="n">rb_id</span><span class="p">,</span>                <span class="c1"># set color to an array/list of desired values</span>
                 <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;Rainbow&#39;</span><span class="p">,</span>   <span class="c1"># choose a colorscale</span>
                 <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span>
             <span class="p">))</span>
        
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
            
            
        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>
        
        
        
        <span class="n">x_visibility</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">y_visibility</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">z_visibility</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s1">&#39;xz&#39;</span> <span class="ow">in</span> <span class="n">plane</span><span class="p">:</span>
            <span class="n">camera</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">eye</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">plane</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;1&#39;</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">y_visibility</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="s1">&#39;xy&#39;</span> <span class="ow">in</span> <span class="n">plane</span><span class="p">:</span>
            <span class="n">camera</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">eye</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">plane</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;1&#39;</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">z_visibility</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="s1">&#39;yz&#39;</span> <span class="ow">in</span> <span class="n">plane</span><span class="p">:</span>
            <span class="n">camera</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">eye</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">plane</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;1&#39;</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">x_visibility</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">scene</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span>
                        <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span>
                        <span class="n">zaxis_title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span>
                        <span class="n">xaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">showgrid</span> <span class="o">=</span>  <span class="kc">True</span><span class="p">,</span>
                                     <span class="n">visible</span> <span class="o">=</span> <span class="n">x_visibility</span><span class="p">,</span>
                                     <span class="n">showline</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                     <span class="n">backgroundcolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
                                     <span class="n">gridcolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                     <span class="n">showbackground</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                     <span class="n">zerolinecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">),</span>
                        <span class="n">yaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">showgrid</span> <span class="o">=</span>  <span class="kc">True</span><span class="p">,</span>
                                     <span class="n">visible</span> <span class="o">=</span> <span class="n">y_visibility</span><span class="p">,</span>
                                     <span class="n">showline</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                     <span class="n">backgroundcolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
                                     <span class="n">gridcolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                     <span class="n">showbackground</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                     <span class="n">zerolinecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">),</span>
                        <span class="n">zaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">showgrid</span> <span class="o">=</span>  <span class="kc">True</span><span class="p">,</span>
                                     <span class="n">visible</span> <span class="o">=</span> <span class="n">z_visibility</span><span class="p">,</span>
                                     <span class="n">showline</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                     <span class="n">backgroundcolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
                                     <span class="n">gridcolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                     <span class="n">showbackground</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                     <span class="n">zerolinecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">),</span>
                        <span class="p">),</span>
                        <span class="c1">#width = 2000, </span>
                        <span class="c1">#height = 2000,</span>
                        <span class="n">autosize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">t</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                                    <span class="n">pad</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                        <span class="n">scene_camera</span><span class="o">=</span><span class="n">camera</span><span class="p">,</span>
                        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="p">)</span>
        
        
        <span class="c1"># fig.update_layout(</span>
        <span class="c1">#     mapbox_layers=[</span>
        <span class="c1">#         {</span>
        <span class="c1">#             # &quot;below&quot;: &quot;traces&quot;,</span>
        <span class="c1">#             # &quot;circle&quot;: {&quot;radius&quot;: 10},</span>
        <span class="c1">#             # &quot;color&quot;:&quot;red&quot;,</span>
        <span class="c1">#             &quot;minzoom&quot;: 4,</span>
        <span class="c1">#             # &quot;source&quot;: gpd.GeoSeries(</span>
        <span class="c1">#                 # df.loc[:, [&quot;Longitude&quot;, &quot;Latitude&quot;]].apply(</span>
        <span class="c1">#                     # shapely.geometry.Point, axis=1</span>
        <span class="c1">#                 # )</span>
        <span class="c1">#             # ).__geo_interface__,</span>
        <span class="c1">#         },</span>
        <span class="c1">#     ],</span>
        <span class="c1">#     mapbox_style=&quot;carto-positron&quot;,</span>
        <span class="c1"># )</span>
        
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">save_fig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fig_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fig_name</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">file_name</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">fig_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fig_path</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">fig_path</span>
            
            <span class="n">fig</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="n">fig_path</span> <span class="o">/</span> <span class="p">(</span><span class="n">fig_name</span><span class="o">+</span><span class="s1">&#39;_MolDistr_.png&#39;</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#, engine=&#39;kaleido&#39;) </span>
        
    <span class="k">else</span><span class="p">:</span>
    
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;You have not placed any molecules in the scene yet. Therefore, PyRID will not create a figure showing molecule positions.&#39;</span><span class="p">)</span></div>

<span class="c1">#%%</span>

<div class="viewcode-block" id="cuboid_data"><a class="viewcode-back" href="../../../Developers/Developer%20API/observables/plot_util.html#pyrid.observables.plot_util.cuboid_data">[docs]</a><span class="k">def</span> <span class="nf">cuboid_data</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]):</span>
    
    <span class="sd">&quot;&quot;&quot;Returns the vertex array of a cuboid given an origin vector.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    origin : `float64[3]`</span>
<span class="sd">        Origin of the cuboid</span>
<span class="sd">    size : `float64[3]`</span>
<span class="sd">        Extend of the cuboid in each dimension. Default = [1,1,1]</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># https://stackoverflow.com/questions/49277753/python-matplotlib-plotting-cuboids</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">[[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
         <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
         <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
         <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
         <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
         <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]]</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">X</span><span class="p">[:,:,</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="n">size</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">X</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span></div>

<div class="viewcode-block" id="draw_cuboid"><a class="viewcode-back" href="../../../Developers/Developer%20API/observables/plot_util.html#pyrid.observables.plot_util.draw_cuboid">[docs]</a><span class="k">def</span> <span class="nf">draw_cuboid</span><span class="p">(</span><span class="n">positions</span> <span class="p">,</span><span class="n">sizes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">edgewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">edgealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;Draws a cuboid of a given size at a given position.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    positions : `float[:]`</span>
<span class="sd">        Position vector</span>
<span class="sd">    size : `float[3]`</span>
<span class="sd">        Extend of the cuboid in each dimension. Default = [1,1,1]</span>
<span class="sd">    colors : `array_like`</span>
<span class="sd">        Array of face colors</span>
<span class="sd">    edgecolor : `string`</span>
<span class="sd">        Edge color. Default = `k`</span>
<span class="sd">    edgewidth : `float`</span>
<span class="sd">        Width of the cuboid edges. Default = 1</span>
<span class="sd">    edgealpha : `float`</span>
<span class="sd">        Opacity of the cuboid edges. Default = 1</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    `tuple(object, object)`</span>
<span class="sd">        Poly3DCollection, Line3DCollection</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># https://stackoverflow.com/questions/49277753/python-matplotlib-plotting-cuboids</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colors</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;C0&quot;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sizes</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span> <span class="n">sizes</span><span class="o">=</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">p</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span><span class="n">sizes</span><span class="p">,</span><span class="n">colors</span><span class="p">):</span>
        <span class="n">g</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">cuboid_data</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">s</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">Poly3DCollection</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">g</span><span class="p">),</span>  
                            <span class="n">facecolors</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">),</span> <span class="n">Line3DCollection</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">g</span><span class="p">),</span> <span class="n">colors</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="n">edgewidth</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">edgealpha</span><span class="p">)</span></div>


<div class="viewcode-block" id="draw_sphere"><a class="viewcode-back" href="../../../Developers/Developer%20API/observables/plot_util.html#pyrid.observables.plot_util.draw_sphere">[docs]</a><span class="k">def</span> <span class="nf">draw_sphere</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;Draws a sphere of given radius and centered at a given position vector.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : `object`</span>
<span class="sd">        Axis object of a matplotlib figure</span>
<span class="sd">    pos : `float[3]`</span>
<span class="sd">        Position of the sphere center</span>
<span class="sd">    radius : `float`</span>
<span class="sd">        Sphere radius</span>
<span class="sd">    col : `string`</span>
<span class="sd">        Sphere color</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    `float[2,3]`</span>
<span class="sd">        Lower left and upper right sphere vertices (Used to set figure aspect ratio).</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># draw sphere</span>
    <span class="n">res</span> <span class="o">=</span> <span class="mi">16</span><span class="n">j</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">res</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span><span class="n">res</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="c1"># ax.plot_wireframe(x, y, z, color=col)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">shade</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">z</span><span class="p">)]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">z</span><span class="p">)])</span></div>

<span class="c1">#%%</span>
    
<div class="viewcode-block" id="plot_triangle"><a class="viewcode-back" href="../../../Developers/Developer%20API/observables/plot_util.html#pyrid.observables.plot_util.plot_triangle">[docs]</a><span class="k">def</span> <span class="nf">plot_triangle</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;Plots a triangle in 3D.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p0 : `float64[3]`</span>
<span class="sd">        Vertex 1</span>
<span class="sd">    p1 : `float64[3]`</span>
<span class="sd">        Vertex 2</span>
<span class="sd">    p2 : `float64[3]`</span>
<span class="sd">        Vertex 3</span>
<span class="sd">    ax : `object`</span>
<span class="sd">        Axis object of a matplotlib figure</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># fig = plt.figure()</span>
    <span class="c1"># ax = plt.axes(projection=&#39;3d&#39;, proj_type = &#39;ortho&#39;)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    
    
    <span class="n">verts</span> <span class="o">=</span> <span class="p">[</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">]</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">Poly3DCollection</span><span class="p">([</span><span class="n">verts</span><span class="p">],</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">edge_color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">50</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">50</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span>
    <span class="c1"># mesh.set_facecolor(face_color)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">edge_color</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_collection3d</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>    
    
    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">185</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">])[:,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">])[:,</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">])[:,</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">])[:,</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">])[:,</span><span class="mi">2</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">])[:,</span><span class="mi">2</span><span class="p">]))</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>
    

<span class="k">def</span> <span class="nf">plot_triangles</span><span class="p">(</span><span class="n">Simulation</span><span class="p">,</span> <span class="n">triangle_ids</span><span class="p">,</span> <span class="n">points</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">vertices</span>
    <span class="n">triangle_ids</span>
    <span class="n">triangles</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">Mesh</span><span class="p">[</span><span class="n">triangle_ids</span><span class="p">][</span><span class="s1">&#39;triangles&#39;</span><span class="p">]</span>

    <span class="c1">#----------------</span>
    
    <span class="n">mygrey</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rgb(153, 153, 153)&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="s1">&#39;rgb(255,255,255)&#39;</span><span class="p">]</span>
    
    <span class="c1">#----------------</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="n">I</span> <span class="o">=</span> <span class="n">triangles</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">J</span> <span class="o">=</span> <span class="n">triangles</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">triangles</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    
                               
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Mesh3d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                        <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
                        <span class="n">colorscale</span><span class="o">=</span><span class="n">mygrey</span><span class="p">,</span> 
                        <span class="n">intensity</span><span class="o">=</span> <span class="n">z</span><span class="p">,</span>
                        <span class="n">flatshading</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">i</span><span class="o">=</span><span class="n">I</span><span class="p">,</span>
                        <span class="n">j</span><span class="o">=</span><span class="n">J</span><span class="p">,</span>
                        <span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;triangles&#39;</span><span class="p">,</span>
                        <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span>
                        <span class="p">)</span>
    
    <span class="n">mesh</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cmin</span><span class="o">=-</span><span class="mi">7</span><span class="p">,</span><span class="c1"># atrick to get a nice plot (z.min()=-3.31909)</span>
                   <span class="n">lighting</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ambient</span><span class="o">=</span><span class="mf">0.18</span><span class="p">,</span>
                                 <span class="n">diffuse</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                 <span class="n">fresnel</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                 <span class="n">specular</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                 <span class="n">roughness</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                                 <span class="n">facenormalsepsilon</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">,</span>
                                 <span class="n">vertexnormalsepsilon</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">),</span>
                   <span class="n">lightposition</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                      <span class="n">y</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                                      <span class="n">z</span><span class="o">=</span><span class="mi">0</span>
                                     <span class="p">),</span>
                   <span class="n">opacity</span> <span class="o">=</span> <span class="mf">0.5</span>
                          <span class="p">);</span>
    
    
    
    <span class="n">tri_points</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">triangles</span><span class="p">]</span>
    
    <span class="c1">#extract the lists of x, y, z coordinates of the triangle vertices and connect them by a line</span>
    <span class="n">Xe</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Ye</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Ze</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">T</span> <span class="ow">in</span> <span class="n">tri_points</span><span class="p">:</span>
        <span class="n">Xe</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">T</span><span class="p">[</span><span class="n">k</span><span class="o">%</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span><span class="o">+</span><span class="p">[</span> <span class="kc">None</span><span class="p">])</span>
        <span class="n">Ye</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">T</span><span class="p">[</span><span class="n">k</span><span class="o">%</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span><span class="o">+</span><span class="p">[</span> <span class="kc">None</span><span class="p">])</span>
        <span class="n">Ze</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">T</span><span class="p">[</span><span class="n">k</span><span class="o">%</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span><span class="o">+</span><span class="p">[</span> <span class="kc">None</span><span class="p">])</span>
    
    <span class="n">lines</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span>
                       <span class="n">x</span><span class="o">=</span><span class="n">Xe</span><span class="p">,</span>
                       <span class="n">y</span><span class="o">=</span><span class="n">Ye</span><span class="p">,</span>
                       <span class="n">z</span><span class="o">=</span><span class="n">Ze</span><span class="p">,</span>
                       <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
                       <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                       <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span> <span class="s1">&#39;rgb(70,70,70)&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>  
    
    
    
    <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">mesh</span><span class="p">,</span> <span class="n">lines</span><span class="p">]</span>
    
    
    
    <span class="n">layout</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
             <span class="n">title</span><span class="o">=</span><span class="s1">&#39;triangles&#39;</span><span class="p">,</span>
             <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">),</span>
             <span class="n">paper_bgcolor</span><span class="o">=</span><span class="s1">&#39;rgb(255,255,255)&#39;</span><span class="p">,</span>
            <span class="p">)</span>
    

    <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        
        <span class="n">xP</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">yP</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">zP</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
        
        <span class="n">points</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xP</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">yP</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">zP</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;points&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        
        
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>

    
    <span class="n">x_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="n">triangles</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">x_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="n">triangles</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">y_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="n">triangles</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">y_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="n">triangles</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">z_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="n">triangles</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">z_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="n">triangles</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">scene</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span>
                    <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span>
                    <span class="n">zaxis_title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span>
                    <span class="n">xaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">nticks</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">],),</span>
                    <span class="n">yaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">nticks</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">],),</span>
                    <span class="n">zaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">nticks</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="p">],),</span>
                    <span class="p">),</span>
                    <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">t</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                                <span class="n">pad</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                    <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
    
    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
<span class="c1">#%%</span>

<div class="viewcode-block" id="plot_path"><a class="viewcode-back" href="../../../Developers/Developer%20API/observables/plot_util.html#pyrid.observables.plot_util.plot_path">[docs]</a><span class="k">def</span> <span class="nf">plot_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">molecule</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;A brief description of what the function (method in case of classes) is and what itâ€™s used for</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameter_1 : dtype</span>
<span class="sd">        Some Information</span>
<span class="sd">    parameter_2 : dtype</span>
<span class="sd">        Some Information</span>
<span class="sd">    </span>
<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    NotImplementedError (just an example)</span>
<span class="sd">        Brief explanation of why/when this exception is raised</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dtype</span>
<span class="sd">        Some information</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#file_path+&#39;hdf5/&#39;+file_name+&#39;.h5&#39;</span>
    <span class="n">hdf</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">measure</span> <span class="o">=</span> <span class="s1">&#39;Position&#39;</span>
    
    <span class="n">Pos</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">hdf</span><span class="p">[</span><span class="n">measure</span><span class="p">][</span><span class="n">molecule</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">Pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hdf</span><span class="p">[</span><span class="n">measure</span><span class="p">][</span><span class="n">molecule</span><span class="p">][</span><span class="n">key</span><span class="p">])</span>
        
    
    <span class="n">Pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Pos</span><span class="p">)</span>
    
    
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span><span class="c1"># fig.gca(projection=&#39;3d&#39;)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Pos</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">Pos</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">Pos</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
    <span class="c1"># ax.legend()</span>
    
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="n">hdf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<span class="c1">#%%</span>

<div class="viewcode-block" id="plot_path_mesh"><a class="viewcode-back" href="../../../Developers/Developer%20API/observables/plot_util.html#pyrid.observables.plot_util.plot_path_mesh">[docs]</a><span class="k">def</span> <span class="nf">plot_path_mesh</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">molecule</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;A brief description of what the function (method in case of classes) is and what itâ€™s used for</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameter_1 : dtype</span>
<span class="sd">        Some Information</span>
<span class="sd">    parameter_2 : dtype</span>
<span class="sd">        Some Information</span>
<span class="sd">    </span>
<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    NotImplementedError (just an example)</span>
<span class="sd">        Brief explanation of why/when this exception is raised</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dtype</span>
<span class="sd">        Some information</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#file_path+&#39;hdf5/&#39;+file_name+&#39;.h5&#39;</span>
    <span class="n">hdf</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">track_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">measure</span> <span class="o">=</span> <span class="s1">&#39;Position&#39;</span>
    
    <span class="n">Pos</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">hdf</span><span class="p">[</span><span class="n">measure</span><span class="p">][</span><span class="n">molecule</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">Pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hdf</span><span class="p">[</span><span class="n">measure</span><span class="p">][</span><span class="n">molecule</span><span class="p">][</span><span class="n">key</span><span class="p">])</span>
        
    
    <span class="n">Pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Pos</span><span class="p">)</span>
    
    
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span><span class="c1"># fig.gca(projection=&#39;3d&#39;)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Pos</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">Pos</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">Pos</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
    <span class="c1"># ax.legend()</span>
    
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="n">hdf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<span class="c1">#%%</span>

<div class="viewcode-block" id="plot_cell_grid"><a class="viewcode-back" href="../../../Developers/Developer%20API/observables/plot_util.html#pyrid.observables.plot_util.plot_cell_grid">[docs]</a><span class="k">def</span> <span class="nf">plot_cell_grid</span><span class="p">(</span><span class="n">Simulation</span><span class="p">,</span> <span class="n">save_fig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">fig_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fig_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Compartments</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;A brief description of what the function (method in case of classes) is and what itâ€™s used for</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameter_1 : dtype</span>
<span class="sd">        Some Information</span>
<span class="sd">    parameter_2 : dtype</span>
<span class="sd">        Some Information</span>
<span class="sd">    </span>
<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    NotImplementedError (just an example)</span>
<span class="sd">        Brief explanation of why/when this exception is raised</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dtype</span>
<span class="sd">        Some information</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># col=sns.color_palette(&quot;colorblind&quot;, 10)</span>
    <span class="n">col</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;rocket&quot;</span><span class="p">,</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">cells_per_dim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">,</span> <span class="n">proj_type</span> <span class="o">=</span> <span class="s1">&#39;persp&#39;</span><span class="p">)</span>
    <span class="c1"># ax = plt.axes(projection=&#39;3d&#39;, proj_type = &#39;ortho&#39;)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">mesh</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">Compartments</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">Compartments</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">X</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Compartments</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">triangles</span><span class="p">):</span>
        
                <span class="n">verts</span> <span class="o">=</span> <span class="p">[</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">]]]</span>
                
                <span class="n">inside</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">verts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">dim</span><span class="p">]</span><span class="o">&lt;-</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
                            <span class="n">inside</span><span class="o">=</span><span class="kc">False</span>
                        <span class="k">if</span> <span class="n">verts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">dim</span><span class="p">]</span><span class="o">&gt;</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
                            <span class="n">inside</span><span class="o">=</span><span class="kc">False</span>
                 
                <span class="k">if</span> <span class="n">inside</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">mesh</span> <span class="o">=</span> <span class="n">Poly3DCollection</span><span class="p">([</span><span class="n">verts</span><span class="p">],</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">face_color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">141</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">184</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">226</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span>
                    <span class="n">edge_color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">50</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">50</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span>
                    <span class="n">mesh</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">face_color</span><span class="p">)</span>
                    <span class="n">mesh</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">edge_color</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_collection3d</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
                
                
    <span class="n">pc</span><span class="p">,</span> <span class="n">lc</span> <span class="o">=</span> <span class="n">draw_cuboid</span><span class="p">(</span><span class="n">positions</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">sizes</span><span class="o">=</span><span class="p">[</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_collection3d</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>    
    <span class="c1"># ax.add_collection3d(lc) </span>
    
    <span class="c1"># for cell in range(Simulation.System.Ncell):</span>

    <span class="k">for</span> <span class="n">cx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">cells_per_dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">cy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">cells_per_dim</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">cz</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">cells_per_dim</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
        
                <span class="n">cell</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">+</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">cells_per_dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">cz</span> <span class="o">*</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">cells_per_dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">cells_per_dim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                
                <span class="c1"># print(cell)</span>
                
                <span class="n">origin</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">AABB_Centers</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span><span class="o">-</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">cell_length_per_dim</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">extent</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">cell_length_per_dim</span>
                
                <span class="n">pc</span><span class="p">,</span> <span class="n">lc</span> <span class="o">=</span> <span class="n">draw_cuboid</span><span class="p">(</span><span class="n">positions</span><span class="o">=</span><span class="p">[</span><span class="n">origin</span><span class="p">],</span> <span class="n">sizes</span><span class="o">=</span><span class="p">[</span><span class="n">extent</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">col</span><span class="p">[</span><span class="n">cx</span><span class="p">],</span> <span class="n">edgewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">edgealpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="c1"># ax.add_collection3d(pc)    </span>
                <span class="n">ax</span><span class="o">.</span><span class="n">add_collection3d</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span> 

                
    <span class="c1">#------------------------------------------------------------------</span>
    
           
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Number of cells = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">Ncell</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="o">-</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">185</span><span class="p">)</span>
    <span class="c1"># ax.view_init(90, -90)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=-</span><span class="mi">7</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;x in $\mu m$&#39;</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;y in $\mu m$&#39;</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;z in $\mu m$&#39;</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">save_fig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fig_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig_name</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">file_name</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">fig_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig_path</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">fig_path</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig_path</span> <span class="o">/</span> <span class="p">(</span><span class="n">fig_name</span><span class="o">+</span><span class="s1">&#39;_CellGrid.png&#39;</span><span class="p">),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span></div>
    
<span class="c1">#%%</span>

<div class="viewcode-block" id="plot_sphere_packing"><a class="viewcode-back" href="../../../Developers/Developer%20API/observables/plot_util.html#pyrid.observables.plot_util.plot_sphere_packing">[docs]</a><span class="k">def</span> <span class="nf">plot_sphere_packing</span><span class="p">(</span><span class="n">Compartment_Number</span><span class="p">,</span> <span class="n">Simulation</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">ptype</span><span class="p">,</span> <span class="n">save_fig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">fig_name</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">,</span> <span class="n">fig_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;A brief description of what the function (method in case of classes) is and what itâ€™s used for</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameter_1 : dtype</span>
<span class="sd">        Some Information</span>
<span class="sd">    parameter_2 : dtype</span>
<span class="sd">        Some Information</span>
<span class="sd">    </span>
<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    NotImplementedError (just an example)</span>
<span class="sd">        Brief explanation of why/when this exception is raised</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dtype</span>
<span class="sd">        Some information</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">molecule_types</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">moltype</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">molecule_types</span><span class="p">):</span>
        <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">molecule_types</span><span class="p">[</span><span class="n">moltype</span><span class="p">]</span><span class="o">.</span><span class="n">radius</span>
        
    <span class="k">if</span> <span class="n">Compartment_Number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Compartment</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">Compartments</span><span class="p">[</span><span class="n">Compartment_Number</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">Compartment_Number</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">Compartment</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span>
        
    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">ptype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ptype</span><span class="p">)</span>

    <span class="n">AABB</span> <span class="o">=</span> <span class="n">Compartment</span><span class="o">.</span><span class="n">AABB</span>
    
    <span class="n">dim</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">AABB</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">AABB</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">AABB</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">AABB</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">depth</span> <span class="o">=</span> <span class="n">AABB</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">AABB</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">dpi</span> <span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
            
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">AABB</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">AABB</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">AABB</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">AABB</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="n">n</span><span class="o">&lt;=</span><span class="mi">10</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                
        <span class="c1"># plt.show()</span>
   
    

    
    <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span><span class="mi">3</span><span class="p">:</span>
    
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">150</span><span class="p">)</span>
        <span class="c1"># ax = plt.axes(projection=&#39;3d&#39;, proj_type = &#39;persp&#39;)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">,</span> <span class="n">proj_type</span> <span class="o">=</span> <span class="s1">&#39;ortho&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">((</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">depth</span><span class="p">))</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">points</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">s</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">ptype</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">ptype</span><span class="p">)</span> 
        
        <span class="k">for</span> <span class="n">tri_id</span> <span class="ow">in</span> <span class="n">Compartment</span><span class="o">.</span><span class="n">triangle_ids</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">Mesh</span><span class="p">[</span><span class="s1">&#39;triangles&#39;</span><span class="p">][</span><span class="n">tri_id</span><span class="p">]</span>
    
            <span class="n">verts</span> <span class="o">=</span> <span class="p">[</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">]]]</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="n">Poly3DCollection</span><span class="p">([</span><span class="n">verts</span><span class="p">],</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">face_color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">141</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">184</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">226</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
            <span class="n">edge_color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">50</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">50</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">face_color</span><span class="p">)</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">edge_color</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_collection3d</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">Compartment</span><span class="o">==</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="p">:</span>
            <span class="n">pc</span><span class="p">,</span> <span class="n">lc</span> <span class="o">=</span> <span class="n">draw_cuboid</span><span class="p">(</span><span class="n">positions</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">sizes</span><span class="o">=</span><span class="p">[</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_collection3d</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>    
            <span class="n">ax</span><span class="o">.</span><span class="n">add_collection3d</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span> 
                
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">AABB</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">AABB</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">AABB</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">AABB</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="n">AABB</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">AABB</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        <span class="c1"># ax.view_init(30, 185)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># ax.set_xlabel(&#39;X&#39;)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=-</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
        
        <span class="c1"># plt.show()</span>
        
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">2000</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">,</span> <span class="n">proj_type</span> <span class="o">=</span> <span class="s1">&#39;persp&#39;</span><span class="p">)</span>
            <span class="c1"># ax = plt.axes(projection=&#39;3d&#39;, proj_type = &#39;ortho&#39;)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">((</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">depth</span><span class="p">))</span>
            
            <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">]</span>
            <span class="n">Aspects</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">pos</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
                <span class="n">Aspects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">draw_sphere</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span><span class="n">R</span><span class="p">[</span><span class="n">ptype</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">cols</span><span class="p">[</span><span class="n">ptype</span><span class="p">[</span><span class="n">i</span><span class="p">]]))</span>
                
            <span class="k">for</span> <span class="n">tri_id</span> <span class="ow">in</span> <span class="n">Compartment</span><span class="o">.</span><span class="n">triangle_ids</span><span class="p">:</span>
                <span class="n">X</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">Mesh</span><span class="p">[</span><span class="s1">&#39;triangles&#39;</span><span class="p">][</span><span class="n">tri_id</span><span class="p">]</span>
        
                <span class="n">verts</span> <span class="o">=</span> <span class="p">[</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">]]]</span>
                <span class="n">mesh</span> <span class="o">=</span> <span class="n">Poly3DCollection</span><span class="p">([</span><span class="n">verts</span><span class="p">],</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="n">face_color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">141</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">184</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">226</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span>
                <span class="n">edge_color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">50</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">50</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span>
                <span class="n">mesh</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">face_color</span><span class="p">)</span>
                <span class="n">mesh</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">edge_color</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">add_collection3d</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
    
            
            <span class="c1"># Aspects = np.array(Aspects)</span>
            <span class="c1"># ax.set_box_aspect((np.max(Aspects[:,:,0])-np.min(Aspects[:,:,0]),np.max(Aspects[:,:,1])-np.min(Aspects[:,:,1]),(np.max(Aspects[:,:,2])-np.min(Aspects[:,:,2]))*0.9))</span>
            
            <span class="k">if</span> <span class="n">Compartment</span><span class="o">==</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="p">:</span>
                <span class="n">pc</span><span class="p">,</span> <span class="n">lc</span> <span class="o">=</span> <span class="n">draw_cuboid</span><span class="p">(</span><span class="n">positions</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">sizes</span><span class="o">=</span><span class="p">[</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="p">])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">add_collection3d</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>    
                <span class="n">ax</span><span class="o">.</span><span class="n">add_collection3d</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span> 
                        
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">AABB</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">AABB</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">AABB</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">AABB</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="n">AABB</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">AABB</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="n">save_fig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fig_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">fig_name</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">file_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">Compartment</span><span class="o">.</span><span class="n">name</span>
                <span class="k">if</span> <span class="n">fig_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">fig_path</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">fig_path</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig_path</span> <span class="o">/</span> <span class="p">(</span><span class="n">fig_name</span><span class="o">+</span><span class="s1">&#39;_Sphere_packing.png&#39;</span><span class="p">),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span></div>
                <span class="c1"># plt.savefig(&#39;Sphere_packing.svg&#39;, dpi = 300)</span>
                
        
<span class="c1">#%%</span>

<div class="viewcode-block" id="plot_mobility_matrix"><a class="viewcode-back" href="../../../Developers/Developer%20API/observables/plot_util.html#pyrid.observables.plot_util.plot_mobility_matrix">[docs]</a><span class="k">def</span> <span class="nf">plot_mobility_matrix</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">Simulation</span><span class="p">,</span> <span class="n">save_fig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">fig_name</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">,</span> <span class="n">fig_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color_scheme</span> <span class="o">=</span> <span class="s1">&#39;colored&#39;</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;A brief description of what the function (method in case of classes) is and what itâ€™s used for</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameter_1 : dtype</span>
<span class="sd">        Some Information</span>
<span class="sd">    parameter_2 : dtype</span>
<span class="sd">        Some Information</span>
<span class="sd">    </span>
<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    NotImplementedError (just an example)</span>
<span class="sd">        Brief explanation of why/when this exception is raised</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dtype</span>
<span class="sd">        Some information</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">my_molecule</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">molecule_types</span><span class="p">[</span><span class="n">molecule</span><span class="p">]</span>
    
    <span class="c1"># Titles = [r&#39;$D_{tt} \, (\mu m^2/s)$&#39;, &#39;$D_{rr} \, (rad/s)$&#39;, &#39;$D_{tr}  \, (\mu m/s)$&#39;, &#39;$D_{rt} \, (\mu m/s)$&#39;]</span>
    <span class="n">Titles</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$D_</span><span class="si">{tt}</span><span class="s1"> \, $&#39;</span><span class="o">+</span><span class="s1">&#39;$(</span><span class="si">{0}</span><span class="s1">^2/</span><span class="si">{1}</span><span class="s1">)$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="s1">&#39;Length&#39;</span><span class="p">],</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">time_unit</span><span class="p">),</span> <span class="s1">&#39;$D_</span><span class="si">{rr}</span><span class="s1"> \,$&#39;</span><span class="o">+</span><span class="s1">&#39;$(rad^2/</span><span class="si">{}</span><span class="s1">)$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">time_unit</span><span class="p">),</span> <span class="s1">&#39;$D_</span><span class="si">{tr}</span><span class="s1">  \, $&#39;</span><span class="o">+</span><span class="s1">&#39;$(</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">)$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">length_unit</span><span class="p">,</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">time_unit</span><span class="p">),</span> <span class="s1">&#39;$D_</span><span class="si">{rt}</span><span class="s1"> \,  $&#39;</span><span class="o">+</span><span class="s1">&#39;$(</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">)$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">length_unit</span><span class="p">,</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">time_unit</span><span class="p">)]</span>
    
    <span class="n">Data</span> <span class="o">=</span> <span class="p">[</span><span class="n">my_molecule</span><span class="o">.</span><span class="n">mu_tb</span><span class="o">*</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">kbt</span><span class="p">),</span> <span class="n">my_molecule</span><span class="o">.</span><span class="n">mu_rb</span><span class="o">*</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">kbt</span><span class="p">)]</span>
    
    
    <span class="c1"># create figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">150</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">wspace</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
    
    <span class="c1"># define widths and heights of the individual subfigures</span>
    <span class="n">widths</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">heights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># create the grid structure</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_gridspec</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">width_ratios</span><span class="o">=</span><span class="n">widths</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="n">heights</span><span class="p">)</span>
    
    <span class="c1"># construct the top (axes object) level subfigure</span>
    <span class="n">left</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">,</span> <span class="n">proj_type</span> <span class="o">=</span> <span class="s1">&#39;persp&#39;</span><span class="p">)</span>
    <span class="n">mid</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">mid</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">right</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>

    
    <span class="n">Aspects</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># for pos, R in zip(my_molecule.pos_rb[:], my_molecule.radii_rb[:]):</span>
    <span class="c1">#     Aspects.append(draw_sphere(top, pos*1e9, R*1e9, &#39;grey&#39;))</span>

    <span class="k">for</span> <span class="n">particle_type</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">R</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">my_molecule</span><span class="o">.</span><span class="n">types</span><span class="p">,</span> <span class="n">my_molecule</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">my_molecule</span><span class="o">.</span><span class="n">radii</span><span class="p">):</span>
        
        <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">particle_types</span><span class="p">[</span><span class="n">particle_type</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="n">R</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">color_scheme</span> <span class="o">==</span> <span class="s1">&#39;flat&#39;</span><span class="p">:</span>
                <span class="n">Aspects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">draw_sphere</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">my_molecule</span><span class="o">.</span><span class="n">radii_rb</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">my_molecule</span><span class="o">.</span><span class="n">radii_rb</span><span class="p">)</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">my_molecule</span><span class="o">.</span><span class="n">radii_rb</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Aspects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">draw_sphere</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">my_molecule</span><span class="o">.</span><span class="n">radii_rb</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">my_molecule</span><span class="o">.</span><span class="n">radii_rb</span><span class="p">)</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">my_molecule</span><span class="o">.</span><span class="n">radii_rb</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">patch_colors</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="mi">24</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">color_scheme</span> <span class="o">==</span> <span class="s1">&#39;flat&#39;</span><span class="p">:</span>
                <span class="n">Aspects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">draw_sphere</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="s1">&#39;white&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Aspects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">draw_sphere</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">core_colors</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="mi">24</span><span class="p">]))</span>
            
            
    <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">get_zlim</span><span class="p">()</span>
    
    <span class="n">left</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">1.25</span><span class="o">*</span><span class="n">xmin</span> <span class="p">,</span><span class="mf">1.25</span><span class="o">*</span><span class="n">xmax</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">left</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mf">1.75</span><span class="o">*</span><span class="n">ymin</span><span class="p">,</span><span class="mf">1.75</span><span class="o">*</span><span class="n">ymax</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">left</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mf">1.25</span><span class="o">*</span><span class="n">zmin</span><span class="p">,</span><span class="mf">1.2</span><span class="o">*</span><span class="n">zmax</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="n">left</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">((</span><span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymax</span><span class="o">-</span><span class="n">ymin</span><span class="p">,(</span><span class="n">zmax</span><span class="o">-</span><span class="n">zmin</span><span class="p">)</span><span class="o">*</span><span class="mf">0.9</span><span class="p">))</span>
    
    <span class="n">left</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">)</span>
    <span class="n">left</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">)</span>
    <span class="n">left</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="n">zmin</span><span class="o">*</span><span class="mf">0.9</span><span class="p">,</span><span class="n">zmax</span><span class="o">*</span><span class="mf">0.9</span><span class="p">)</span>
    
    <span class="c1"># Aspects = np.array(Aspects)</span>
    <span class="c1"># left.set_box_aspect((np.max(Aspects[:,:,0])-np.min(Aspects[:,:,0]),np.max(Aspects[:,:,1])-np.min(Aspects[:,:,1]),(np.max(Aspects[:,:,2])-np.min(Aspects[:,:,2]))*0.9))</span>

    
    <span class="n">left</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">my_molecule</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">left</span><span class="o">.</span><span class="n">w_xaxis</span><span class="o">.</span><span class="n">set_pane_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">left</span><span class="o">.</span><span class="n">w_yaxis</span><span class="o">.</span><span class="n">set_pane_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">left</span><span class="o">.</span><span class="n">w_zaxis</span><span class="o">.</span><span class="n">set_pane_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">left</span><span class="o">.</span><span class="n">w_xaxis</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">left</span><span class="o">.</span><span class="n">w_yaxis</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">left</span><span class="o">.</span><span class="n">w_zaxis</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>

    <span class="n">left</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x in $</span><span class="si">{}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="s1">&#39;Length&#39;</span><span class="p">]),</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">left</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y in $</span><span class="si">{}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="s1">&#39;Length&#39;</span><span class="p">]),</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">left</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;z in $</span><span class="si">{}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="s1">&#39;Length&#39;</span><span class="p">]),</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    
    <span class="c1"># left.tick_params(axis=&#39;x&#39;, pad=-2)</span>
    <span class="c1"># left.tick_params(axis=&#39;y&#39;, pad=-2)</span>
    <span class="c1"># left.tick_params(axis=&#39;z&#39;, pad=-2)</span>
    
    <span class="n">left</span><span class="o">.</span><span class="n">locator_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">left</span><span class="o">.</span><span class="n">locator_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">left</span><span class="o">.</span><span class="n">locator_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">mid</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">Titles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    
    <span class="c1"># divider = make_axes_locatable(mid)</span>
    <span class="c1"># cax = divider.append_axes(&#39;right&#39;, size=&#39;5%&#39;, pad=0.05)</span>
    <span class="c1"># im1 = mid.matshow(Data[0])</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">Data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">mid</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fontsize&quot;</span><span class="p">:</span><span class="mi">8</span><span class="p">},</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.3g&#39;</span><span class="p">,</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;shrink&quot;</span><span class="p">:</span> <span class="mf">.7</span><span class="p">,</span> <span class="s2">&quot;ticks&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Data</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mf">0.95</span><span class="p">],</span><span class="mi">3</span><span class="p">)},</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;YlOrBr&quot;</span><span class="p">)</span>
    <span class="c1"># cb = fig.colorbar(im1, cax=cax, orientation=&#39;vertical&#39;)</span>
    <span class="c1"># cb.formatter.set_scientific(True)</span>
    <span class="c1"># cb.locator.axis.get_offset_text().set_x(5)</span>
    
    <span class="n">right</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">Titles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    
    <span class="c1"># divider = make_axes_locatable(right)</span>
    <span class="c1"># cax = divider.append_axes(&#39;right&#39;, size=&#39;5%&#39;, pad=0.05)</span>
    <span class="c1"># im1 = right.matshow(Data[0])</span>
    <span class="c1"># cb = fig.colorbar(im1, cax=cax, orientation=&#39;vertical&#39;)</span>
    <span class="c1"># cb.formatter.set_scientific(True)</span>
    <span class="c1"># cb.locator.axis.get_offset_text().set_x(5)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">Data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">right</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fontsize&quot;</span><span class="p">:</span><span class="mi">8</span><span class="p">},</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2g&quot;</span><span class="p">,</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;shrink&quot;</span><span class="p">:</span> <span class="mf">.7</span><span class="p">,</span> <span class="s2">&quot;ticks&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Data</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Data</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.95</span><span class="p">],</span><span class="mi">3</span><span class="p">)},</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;YlOrBr&quot;</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="c1"># fig.tight_layout() </span>
    <span class="k">if</span> <span class="n">save_fig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fig_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig_name</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">file_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">molecule</span>
        <span class="k">if</span> <span class="n">fig_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig_path</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">fig_path</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;saved figure.&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig_path</span> <span class="o">/</span> <span class="p">(</span><span class="n">fig_name</span><span class="o">+</span><span class="s1">&#39;_DiffusionMatrix.png&#39;</span><span class="p">),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span></div>
    
    
    
<span class="c1">#%%</span>

<div class="viewcode-block" id="plot_potential"><a class="viewcode-back" href="../../../Developers/Developer%20API/observables/plot_util.html#pyrid.observables.plot_util.plot_potential">[docs]</a><span class="k">def</span> <span class="nf">plot_potential</span><span class="p">(</span><span class="n">Simulation</span><span class="p">,</span> <span class="n">Potentials</span><span class="p">,</span> <span class="n">yU_limits</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">yF_limits</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">r_limits</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">save_fig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;A brief description of what the function (method in case of classes) is and what itâ€™s used for</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameter_1 : dtype</span>
<span class="sd">        Some Information</span>
<span class="sd">    parameter_2 : dtype</span>
<span class="sd">        Some Information</span>
<span class="sd">    </span>
<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    NotImplementedError (just an example)</span>
<span class="sd">        Brief explanation of why/when this exception is raised</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dtype</span>
<span class="sd">        Some information</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>
    <span class="c1"># sns.set_context(&quot;paper&quot;)</span>
    <span class="c1"># sns.set_context(&quot;talk&quot;)</span>
    <span class="c1"># sns.set_context(&quot;poster&quot;)</span>
    <span class="c1"># sns.set_context(&quot;notebook&quot;, font_scale=1.5, rc={&quot;lines.linewidth&quot;: 2.5})</span>
    
    <span class="n">length_units_prefix</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">length_units_prefix</span><span class="p">[</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">length_unit</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">r_limits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="o">*</span><span class="n">length_units_prefix</span><span class="o">/</span><span class="mf">1e9</span><span class="p">,</span><span class="mi">100</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">r_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">r_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">100</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="s1">&#39;figU&#39;</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">150</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="s1">&#39;figF&#39;</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">150</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">pot</span><span class="p">,</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">Potentials</span><span class="p">:</span>
        <span class="n">U</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">F</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">ri</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
            <span class="n">U</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pot</span><span class="p">(</span><span class="n">ri</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">args</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pot</span><span class="p">(</span><span class="n">ri</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">args</span><span class="p">))[</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="s1">&#39;figU&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">))</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="s1">&#39;figF&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">))</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="s1">&#39;figU&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">yU_limits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">yU_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yU_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;r in </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="s1">&#39;Length&#39;</span><span class="p">]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;U in </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">save_fig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">fig_name</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">file_name</span>
        <span class="n">fig_path</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">fig_path</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;saved figure.&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig_path</span> <span class="o">/</span> <span class="p">(</span><span class="n">fig_name</span><span class="o">+</span><span class="s1">&#39;_potential_energy.png&#39;</span><span class="p">),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="s1">&#39;figF&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">yF_limits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">yF_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yF_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;r in </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="s1">&#39;Length&#39;</span><span class="p">]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;F in </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="s1">&#39;Force&#39;</span><span class="p">]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">save_fig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">fig_name</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">file_name</span>
        <span class="n">fig_path</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">fig_path</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;saved figure.&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig_path</span> <span class="o">/</span> <span class="p">(</span><span class="n">fig_name</span><span class="o">+</span><span class="s1">&#39;_potential_force.png&#39;</span><span class="p">),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

    
   
        
<span class="c1">#%%</span>

<div class="viewcode-block" id="plot_concentration_profile"><a class="viewcode-back" href="../../../Developers/Developer%20API/observables/plot_util.html#pyrid.observables.plot_util.plot_concentration_profile">[docs]</a><span class="k">def</span> <span class="nf">plot_concentration_profile</span><span class="p">(</span><span class="n">Simulation</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">save_fig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">fig_name</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">,</span> <span class="n">fig_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;A brief description of what the function (method in case of classes) is and what itâ€™s used for</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameter_1 : dtype</span>
<span class="sd">        Some Information</span>
<span class="sd">    parameter_2 : dtype</span>
<span class="sd">        Some Information</span>
<span class="sd">    </span>
<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    NotImplementedError (just an example)</span>
<span class="sd">        Brief explanation of why/when this exception is raised</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dtype</span>
<span class="sd">        Some information</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># cells_per_dim = np.array([15,5,5])</span>
    <span class="c1"># box_lengths = np.array([0.15,0.05,0.05])</span>
    <span class="c1"># cell_length_per_dim = box_lengths/cells_per_dim</span>
    
    <span class="n">cells_axis</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">box_lengths</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">box_lengths</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">1e-10</span><span class="p">)</span> <span class="c1"># Some molecules may lie on the border, therefore the small multiplicative factor. Otherwise we could get out of bound errors.</span>
    <span class="n">cell_length_axis</span> <span class="o">=</span> <span class="n">box_lengths</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">/</span><span class="n">cells_axis</span>
    
    <span class="n">Histograms</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">mol_type</span> <span class="ow">in</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">molecule_types</span><span class="p">:</span>
        <span class="n">Histograms</span><span class="p">[</span><span class="n">mol_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cells_axis</span><span class="p">)</span>
    
    <span class="n">axis_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">]</span>
    <span class="n">ax123</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">ax123</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">ax123</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ax123</span><span class="p">)</span>
    <span class="n">volume_cell</span> <span class="o">=</span> <span class="n">cell_length_axis</span><span class="o">*</span><span class="n">box_lengths</span><span class="p">[</span><span class="n">ax123</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">*</span><span class="n">box_lengths</span><span class="p">[</span><span class="n">ax123</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    
    <span class="k">for</span> <span class="n">key0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Simulation</span><span class="o">.</span><span class="n">RBs</span><span class="o">.</span><span class="n">occupied</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">RBs</span><span class="o">.</span><span class="n">occupied</span><span class="p">[</span><span class="n">key0</span><span class="p">]</span> 
        
        <span class="n">mol_type</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">RBs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        
        <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">Simulation</span><span class="o">.</span><span class="n">RBs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="n">axis</span><span class="p">]</span><span class="o">+</span><span class="n">box_lengths</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">cell_length_axis</span><span class="p">)</span>
        
        <span class="n">volume_mol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">4</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">molecule_types</span><span class="p">[</span><span class="n">mol_type</span><span class="p">]</span><span class="o">.</span><span class="n">radii</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
        
        <span class="n">Histograms</span><span class="p">[</span><span class="n">mol_type</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">volume_mol</span>
    
    
    <span class="k">for</span> <span class="n">mol_type</span> <span class="ow">in</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">molecule_types</span><span class="p">:</span>
        <span class="n">Histograms</span><span class="p">[</span><span class="n">mol_type</span><span class="p">]</span><span class="o">/=</span><span class="n">volume_cell</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">dpi</span> <span class="o">=</span><span class="mi">150</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">mol_type</span> <span class="ow">in</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">molecule_types</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">box_lengths</span><span class="p">[</span><span class="n">axis</span><span class="p">],</span><span class="n">cells_axis</span><span class="p">),</span><span class="n">Histograms</span><span class="p">[</span><span class="n">mol_type</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mol_type</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">axis_name</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; in $\mu m$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Packing fraction $\Phi$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    
        
    <span class="k">if</span> <span class="n">save_fig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fig_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig_name</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">file_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">axis_name</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">fig_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig_path</span> <span class="o">=</span> <span class="n">Simulation</span><span class="o">.</span><span class="n">fig_path</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig_path</span> <span class="o">/</span> <span class="p">(</span><span class="n">fig_name</span><span class="o">+</span><span class="s1">&#39;_Profile.png&#39;</span><span class="p">),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span>
    
    
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Moritz F P Becker.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>